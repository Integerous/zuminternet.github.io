<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/BlogPosting">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ZUM 기술 블로그</title>
    <meta name="title" content="ZUM 기술 블로그"/>
    <meta name="description" content="웹 서비스(Spring Framework)의 세션을 Membase(현재의 Couchbase)로 관리하면서 발생한 이슈입니다. 이슈를 해결해 나가는 과정을 기록으로 남깁니다.">

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@zum_com">
    <meta name="twitter:title" content="버그 트래킹 일지(1) - 시작은 사전지식 확보부터 | ZUM tech">
    <meta name="twitter:description" content="웹 서비스(Spring Framework)의 세션을 Membase(현재의 Couchbase)로 관리하면서 발생한 이슈입니다. 이슈를 해결해 나가는 과정을 기록으로 남깁니다.">
    
    <meta property="twitter:image:src" content="/images/portal/post/2017-02-22-BUG-TRACKING-1/vbucket.png">
    



    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="http://localhost:4000/BUG-TRACKING-1/">
    <meta property="og:title" content="버그 트래킹 일지(1) - 시작은 사전지식 확보부터 | ZUM tech">
    
    <meta property="og:image" content="/images/portal/post/2017-02-22-BUG-TRACKING-1/vbucket.png">
    
    <meta property="og:description" content="웹 서비스(Spring Framework)의 세션을 Membase(현재의 Couchbase)로 관리하면서 발생한 이슈입니다. 이슈를 해결해 나가는 과정을 기록으로 남깁니다.">
    <meta property="og:site_name" content="ZUM 기술 블로그">

    <!-- Social: Google+ / Schema.org  -->
    <meta itemprop="name" content="버그 트래킹 일지(1) - 시작은 사전지식 확보부터 | ZUM tech"/>
    <meta itemprop="description" content="웹 서비스(Spring Framework)의 세션을 Membase(현재의 Couchbase)로 관리하면서 발생한 이슈입니다. 이슈를 해결해 나가는 과정을 기록으로 남깁니다.">
    <meta itemprop="image" content="http://localhost:4000/assets/img/blog-image.png"/>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="ZUM tech Blog">
    <meta name="msapplication-TileColor" content="#0562DC">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="http://localhost:4000/BUG-TRACKING-1/">
    <link rel="alternate" type="application/rss+xml" title="ZUM 기술 블로그" href="http://localhost:4000/feed.xml" />
</head>

    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-google-plus" viewBox="0 0 951 1024"><path class="path1" d="M420 454.857q0 20.571 18.286 40.286t44.286 38.857 51.714 42 44 59.429 18.286 81.143q0 51.429-27.429 98.857-41.143 69.714-120.571 102.571t-170.286 32.857q-75.429 0-140.857-23.714t-98-78.571q-21.143-34.286-21.143-74.857 0-46.286 25.429-85.714t67.714-65.714q74.857-46.857 230.857-57.143-18.286-24-27.143-42.286t-8.857-41.714q0-20.571 12-48.571-26.286 2.286-38.857 2.286-84.571 0-142.571-55.143t-58-139.714q0-46.857 20.571-90.857t56.571-74.857q44-37.714 104.286-56t124.286-18.286h238.857l-78.857 50.286h-74.857q42.286 36 64 76t21.714 91.429q0 41.143-14 74t-33.714 53.143-39.714 37.143-34 35.143-14 37.714zM336.571 400q21.714 0 44.571-9.429t37.714-24.857q30.286-32.571 30.286-90.857 0-33.143-9.714-71.429t-27.714-74-48.286-59.143-66.857-23.429q-24 0-47.143 11.143t-37.429 30q-26.857 33.714-26.857 91.429 0 26.286 5.714 55.714t18 58.857 29.714 52.857 42.857 38.286 55.143 14.857zM337.714 898.857q33.143 0 63.714-7.429t56.571-22.286 41.714-41.714 15.714-62.286q0-14.286-4-28t-8.286-24-15.429-23.714-16.857-20-22-19.714-20.857-16.571-23.714-17.143-20.857-14.857q-9.143-1.143-27.429-1.143-30.286 0-60 4t-61.429 14.286-55.429 26.286-39.143 42.571-15.429 60.286q0 40 20 70.571t52.286 47.429 68 25.143 72.857 8.286zM800.571 398.286h121.714v61.714h-121.714v125.143h-60v-125.143h-121.143v-61.714h121.143v-124h60v124z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <a id="search" class="dosearch">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            ZUM tech
        </a>
    </h1>
</header>

<div id="mask" class="overlay"></div>

<aside id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
          <li><a href="http://localhost:4000">Home</a></li>
          <li><a href="http://zuminternet.com" target="_blank">Contact</a></li>
        <li><a class="feed" href="http://localhost:4000/feed.xml" title="Atom/RSS feed">Feed</a></li>
      </ul>
    </nav>
</aside>
<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>


        <section class="post">

            <article role="article" id="post" class="post-content" itemprop="articleBody">
                <p itemprop="post-info" class="post-info">
                    
                        <svg id="date" class="icon-calendar"><use xlink:href="#icon-calendar"></use></svg>
                        <time itemprop="datePublished" datetime="2017-02-22T00:00:00+09:00" class="date">
                            


February 22, 2017

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>7 min to read</span>
                </p>
                <h1 class="post-title" itemprop="name">버그 트래킹 일지(1) - 시작은 사전지식 확보부터</h1>
            <p/>
                <p>주니어개발자의 버그 트래킹 일지입니다!</p>

<p>주 내용은 웹 서비스의 세션을 Membase(현재의 Couchbase)로 관리하면서 발생한 이슈입니다. 이슈를 해결해 나가는 과정을 기록으로 남깁니다.</p>

<p><strong>버그 트래킹 일지(1) - 시작은 사전지식 확보부터</strong> <br />
<a href="http://localhost:4000/BUG-TRACKING-2">버그 트래킹 일지(2) - 로그를 보자!</a><br />
<a href="http://localhost:4000/BUG-TRACKING-3">버그 트래킹 일지(3) - 임시방편보단 장기적으로</a><br />
<a href="http://localhost:4000/BUG-TRACKING-4">버그 트래킹 일지(4) - 의심하고 또 의심하자</a><br />
<a href="http://localhost:4000/BUG-TRACKING-5">버그 트래킹 일지(5) - 대망의 적용 배포 그리고 결론</a></p>

<h3 id="버그트래킹-환경">버그트래킹 환경</h3>

<ul>
  <li>
    <p>Membase Server</p>

    <ul>
      <li>Version : 1.7.2</li>
      <li>
        <p>Node</p>

        <ul>
          <li>4개</li>
          <li>노드당 Replica 2개</li>
          <li>노드당 할당 메모리 2GB</li>
        </ul>
      </li>
      <li>
        <p>Bucket</p>

        <ul>
          <li>1개</li>
          <li>메모리 8GB(노드당 메모리 * 노드 수)</li>
        </ul>
      </li>
      <li>
        <p>각 서버 스팩</p>

        <ul>
          <li>RAM 8GB</li>
          <li>HDD 30GB</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>WEB Server</p>

    <ul>
      <li>Spring Boot Web Application(version 1.2)
        <ul>
          <li>SpyMemCached(version 2.7.3)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="버그트래킹의-시작은-사전지식-확보부터">버그트래킹의 시작은 사전지식 확보부터</h2>

<p>버그 트래킹을 할 때 알고 있는 지식 내에서 발생한 이슈라면 좋겠지만, 대부분의 버그는 알고 있지 않은 부분에서 시작됩니다. 그렇기때문에 버그를 트래킹할 때 무작정 달려들기 전 전반적인 사전지식의 확보가 필수라고 생각했습니다.</p>

<p>그래서 첫번째로 저는 Spring에서 Membase를 세션관리로 사용할 때 알고 있어야할 지식들을 조사했습니다.</p>

<p>모든 것을 알 수 없기때문에 <strong>의심이 됐던</strong> , 그리고 <strong>불확실했던</strong> 지식들만 빠르게 습득하였습니다!</p>

<hr />

<h2 id="조사한-사전-지식">조사한 사전 지식</h2>

<h3 id="couchbasemembase">CouchBase(Membase)</h3>

<h4 id="1-bucket">1. Bucket</h4>

<p>Couchbase Server 클러스터의 물리적 리소스의 논리적 그룹</p>

<p><strong>종류</strong></p>

<ul>
  <li>Couchbase
    <ul>
      <li>영구 및 복제 서비스를 제공하여 높은 가용성과 동적 재구성 가능한 분산 데이터 스토리지를 제공</li>
    </ul>
  </li>
  <li>Memcached
    <ul>
      <li>직접 주소 지정 (확장)은 분산 메모리에 키와 값의 캐시를 제공</li>
      <li>버킷은 관계형 데이터베이스 기술과 함께 사용하도록 설계</li>
    </ul>
  </li>
</ul>

<p><strong>주요 기능</strong></p>

<ul>
  <li>Rebalancing
    <ul>
      <li>자원과 동적 추가 또는 클러스터의 버킷과 서버 제거 간 부하 분산을 가능하게 함</li>
    </ul>
  </li>
  <li>Replacing
    <ul>
      <li>복제 서버 설정 가능한 수는 Couchbase(Membase) 유형 버킷의 모든 데이터 객체의 복사본을 받을 수 있습니다. 호스트 시스템에 장애가 발생한 경우, 복제 서버가 Fail Over를 통해 avilability 클러스터 작업을 제공하고 호스트 서버로 승격 할 수 있습니다. 복제가 버킷 레벨로 설정되어 있습니다.</li>
    </ul>
  </li>
</ul>

<p><strong>vBucket</strong></p>

<ul>
  <li>실제데이타와 물리서버간의 맵핑을 관리</li>
  <li>각 키가 어디에 저장되어 있는지를 vBucket이라는 단위로 관리</li>
  <li>키에 대한 해쉬값을 계산한 후에, 각 해쉬값에 따라서 저장되는 vBucket을 맵핑한다음 각 vBucket을 노드에 맵핑</li>
</ul>

<p><img src="/images/portal/post/2017-02-22-BUG-TRACKING-1/vbucket.png" alt="vBucket" /></p>

<p>출처 : http://docs.couchbase.com/couchbase-manual-2.5/cb-admin/#vbuckets</p>

<h4 id="2-node">2. Node</h4>

<ul>
  <li>Couchbase(Membase)는 여러 개의 노드로 이루어진 클러스터로 구성</li>
  <li>물리적인 서버에서 기동하는 하나의 Couchbase(Membase) 인스턴스</li>
</ul>

<p><img src="/images/portal/post/2017-02-22-BUG-TRACKING-1/node.png" alt="vBucket" /></p>

<p>출처 : http://hamait.tistory.com/198</p>

<p><strong>Cluster Manager</strong></p>

<ul>
  <li>8091 포트의 REST API를 통해서, 설정 정보와 vBucket 정보를 읽어옴</li>
</ul>

<p><strong>Data Manager</strong></p>

<ul>
  <li>직접 데이터에 접근하는 부분</li>
  <li>윗단에는 memcached가 있으며, 데이터를 cache하는데 사용</li>
  <li>Memcached 위에는 moxi가 Proxy로 사용</li>
</ul>

<p><strong>데이터 쓰기, 복제</strong></p>

<ol>
  <li>Client SDK를 통해서 쓰기 요청</li>
  <li>해쉬 알고리즘에 따라 데이터의 키 값에 맵핑 되는 vBucket을 탐색</li>
  <li>vBucket에 맵핑 되는 노드를 찾아서 쓰기 요청</li>
  <li>쓰기 요청은 해당 노드의 Listener로 전달</li>
  <li>들어온 데이터를 로컬의 캐쉬에 씀</li>
  <li>클러스터의 다른 노드로 복제 요청</li>
  <li>노드의 디스크에 데이터 저장</li>
</ol>

<p><img src="/images/portal/post/2017-02-22-BUG-TRACKING-1/node_copy.png" alt="vBucket" /></p>

<p>출처 : http://hamait.tistory.com/198</p>

<h4 id="3-rebalancing">3. Rebalancing</h4>

<ul>
  <li>새롭게 배치된 데이터에 따라서 vBucket to 노드간의 데이터 맵핑 정보 업데이트</li>
  <li>노드가 클러스터에 추가되거나, 장애등의 이유로 삭제되었을 때 물리적으로 데이터가 다른 노드로 다시 분산 배치</li>
  <li><strong>노드간에 데이터 복제가 심하게 일어나기 때문에, 리밸런스는 부하가 적은 시간대에 하도록 권장</strong></li>
</ul>

<h4 id="4-failover">4. FailOver</h4>

<p><code class="highlighter-rouge">Failover</code>는 Couchbase(membase) 클러스터의 노드에서 수행되며 이는 비정상이고 더 이상 도달 할 수없는 노드에서 수행됩니다. 그 목적은 비정상적인 노드를 제거하고 다른 노드에서 복제본 데이터를 사용 가능하게하여 클러스터를 일관된 상태로 만드는 것입니다.</p>

<p>Failover의 동작은 아래와 같습니다.</p>

<ol>
  <li>클러스터의 새로운 토폴로지로 업데이트 된 클러스터 맵을 수신</li>
  <li>새로운 설정에 적응</li>
  <li>현재 활성 구성과 비교</li>
  <li>어떤 TCP 연결 및 자원을 종료 및 제거해야하는지 결정</li>
  <li>장애 조치 노드에서 처리하는 복제 된 데이터가 클러스터의 다른 노드에서 활성화</li>
</ol>

<p>공식 홈페이지에서는 FailOver 동작에 대해 아래의 경고를 제공합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>When a node is removed from the cluster during failover, it's possible for operations to be in mid-flight as a request or response from the server or being processed on the server. This means that the underlying TCP connection executing the operation may be closed by the server or the client which would result. In most cases this will result in that operation failing with either a with a client or server IO exception. In certain cases the operation will be retried up until it's configured operation "lifespan". It may be retried multiple times and fail multitple times until it either succeeds to or times out. In the event of a timeout, an OperationTimeoutException will returned in the Exception field of the IOperationResult.
</code></pre></div></div>

<p>위의 동작 과정 등이 리소스에 어느 정도 영향을 미치므로, 아래의 Exception들이 발생할 수 있다고 합니다.</p>

<ul>
  <li>OperationTimeoutException</li>
  <li>NodeUnavailableException</li>
  <li>ConnectionUnavailableException</li>
</ul>

<p><strong>Auto FailOver</strong></p>

<p><code class="highlighter-rouge">Auto Fialover</code>는 설정해준 시간을 주기로 각 노드 서버의 상황을 확인하고, 해당 노드 서버가 장애라고 판단되면 해당 서버를 FailOver 시켜주는 옵션입니다.<br /></p>

<ul>
  <li>세 개 이상의 노드가 포함 된 클러스터에서만 사용 가능</li>
  <li>Default는 사용하지 않도록 비활성화</li>
  <li>모든 노드 연쇄 FailOver를 방지하기 위해 하나의 노드까지만 자동 장애 조치</li>
  <li>지정된 지연 기간 내에 두 개 이상의 노드가 동시에 다운되면 자동 장애 조치를 하지 않음</li>
  <li>확인 주기는 최소 30초</li>
</ul>

<hr />

<p><a href="http://docs.couchbase.com/admin/admin">참고 : Couchbase Docs</a></p>

<p><a href="http://docs.couchbase.com/couchbase-manual-2.5">참고 : Couchbase Administrator Guide</a></p>

<p><a href="http://goldfing.blogspot.kr/2013/03/couchbase-server-20-bucket.html">참고 : Bucket이란? : hans story</a></p>

<p><a href="http://hamait.tistory.com/198">참고 : 카우치베이스(Couchbase) 서버-#6 아키텍쳐 구조 살펴보기 : 조대협의 블로그</a></p>

<p><br /></p>

<h3 id="spring-security">Spring Security</h3>

<ul>
  <li>인증(Authentication)과 권한부여(Authorization)를 담당</li>
  <li>세션 정보의 존재 여부에 따라 인증을 판단</li>
  <li>사용자의 보호 및 인증된 세션을 SecurityContext에 저장</li>
</ul>

<h4 id="1-securitycontextpersistencefilter">1. SecurityContextPersistenceFilter</h4>

<ul>
  <li><code class="highlighter-rouge">SecurityContext</code>를 로드하고 저장하는 역할을 담당</li>
</ul>

<h4 id="2-securitycontextrepository">2. SecurityContextRepository</h4>

<ul>
  <li><code class="highlighter-rouge">SecurityContextPersistenceFilter</code>에서 <code class="highlighter-rouge">SecurityContext</code>가 저장될 저장소와의 통신과 관련된 기능을 담당
    <ul>
      <li><code class="highlighter-rouge">MemcachedSecurityContextRepository</code>(자체 구현) 사용</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">Session</code> Object를 생성 인자로 갖음</li>
</ul>

<h3 id="3-spymemcached">3. SpyMemcached</h3>

<p>클라이언트단에서 Couchbase(Membase)와 통신을 지원하는 오픈소스 클라이언트 SDK</p>

<h4 id="4-memcachedclient">4. MemcachedClient</h4>

<ul>
  <li>Couchbase(Membase)의 정보 및 통신과 관련된 기능을 담당</li>
  <li>생성 인자로 Bucket 생성에 필요한 정보(server list, bucket name, pwd)를 갖음</li>
</ul>

<h4 id="5-session">5. Session</h4>

<ul>
  <li><code class="highlighter-rouge">Session</code> 정보를 생성, 변경 및 로드하는 역할을 담당
    <ul>
      <li><code class="highlighter-rouge">MemcachedSession</code>(자체 구현) 사용</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">SecurityContextRepository</code>의 생성인자로 <code class="highlighter-rouge">SecurityContextRepository</code>에 유일한 객체로 생성 됨</li>
</ul>

<hr />

<p>이렇게 첫번째 사전 지식을 확보했습니다. 이제 본격적인 원인 분석에 들어갈 수 있습니다.</p>

<p><strong>사전지식의 확보로 간단한 문제에 대한 결론도 낼 수 있었습니다.!</strong></p>

<hr />

<h3 id="어플리케이션-다운-사태">어플리케이션 다운 사태</h3>

<p><strong>리벨런싱 도중 어플리케이션 다운</strong></p>

<p><code class="highlighter-rouge">리벨런싱</code>이 많은 리소스를 사용하므로, 트래픽이 많은 상황에서 피해야 한다는 경고는 알고 있습니다. 그러나 <code class="highlighter-rouge">리벨런싱</code> 상황에 <code class="highlighter-rouge">Membase Server</code>가 죽은 것이 아닌 <code class="highlighter-rouge">어플리케이션</code>이 죽은 상황에 대해서는 정확한 파악이 필요해보였습니다.</p>

<p>결론부터 이야기하자면 원인은 <code class="highlighter-rouge">Main Thread</code>의 <code class="highlighter-rouge">StackOverFlow</code> 입니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Exception</span> <span class="n">in</span> <span class="n">thread</span> <span class="s">"Memcached IO over {MemcachedConnection to xxxxxxxxxxxxxxxxxxxxxxx}"</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">StackOverflowError</span>
        <span class="n">at</span> <span class="n">net</span><span class="o">.</span><span class="na">spy</span><span class="o">.</span><span class="na">memcached</span><span class="o">.</span><span class="na">ops</span><span class="o">.</span><span class="na">MultiOperationCallback</span><span class="o">.</span><span class="na">complete</span><span class="o">(</span><span class="n">MultiOperationCallback</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">33</span><span class="o">)</span>
                <span class="o">...</span>
                <span class="n">at</span> <span class="n">net</span><span class="o">.</span><span class="na">spy</span><span class="o">.</span><span class="na">memcached</span><span class="o">.</span><span class="na">ops</span><span class="o">.</span><span class="na">MultiOperationCallback</span><span class="o">.</span><span class="na">complete</span><span class="o">(</span><span class="n">MultiOperationCallback</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">33</span><span class="o">)</span>
</code></pre></div></div>

<p>Memcached는 vBucket을 기반으로 해당 데이터가 어디에 있는지 판단을 하게 됩니다. vBucket을 통해 데이터를 탐색할 때 뱉게되는 Error로 <code class="highlighter-rouge">WARN</code> Level로 로깅되는 <code class="highlighter-rouge">NOT_MY_BUCKET</code>이란 것이 있습니다. 해당 Error는 해당 vBucket에 데이터가 없을 경우 경고를 띄운 뒤 재귀 탐색을 통해 다른 vBucket으로 데이터를 탐색하는 로직을 가지고 있습니다.</p>

<p><code class="highlighter-rouge">리벨런싱</code> 작업이 수행될 때 수많은 데이터가 vBucket에서 제외되어 데이터를 분배하는 복잡한 과정이 수행됩니다. 이 과정 중간에 특정 데이터를 요청했을 때 해당 데이터가 <code class="highlighter-rouge">리벨런싱</code> 과정 중 vBucket에서 제외되었다면, vBucket 안에 데이터가 자리 잡을 때까지 재귀탐색을 하게 되며, 리벨런싱 되야하는 데이터양이 많은 경우 이 작업에 긴 시간이 생기며, 그 긴 시간동안 MainThread에서는 엄청나게 빠른 속도로 재귀 탐색을 하다 결국 StatckOverFlow Error를 뱉게 되는 상황이였습니다.</p>

<p>해당 문제의 해결방법은 <code class="highlighter-rouge">Couchbase</code>에서 경고하듯, <code class="highlighter-rouge">트레픽</code>이 적은 시간대에 최대한 빠르게 <code class="highlighter-rouge">리벨런싱</code>을 수행하는 방법뿐이 없다고 판단됩니다.</p>

<hr />

<p>아마 Membase와 Spring의 Session의 모든 것을 공부하려면, 몇주 혹은 몇달이 소요될 수도 있었을 것 입니다. <strong>의심이 됐던</strong> , 그리고 <strong>불확실했던</strong> 지식들만 빠르게 습득하는 것이 중요할 것 같습니다.</p>

<p>다음에 계속..<a href="http://localhost:4000/BUG-TRACKING-2">버그 트래킹 일지(2) - 로그를 보자!</a></p>

            </article>

            <div class="progress-bar" data-minutes="7">
                <span class="time-completed"></span>
                <span class="time-remaining"></span>
                <div class="bar">
                    <span class="completed" style="width:0%;"></span>
                    <span class="remaining" style="width:100%;"></span>
                </div>
            </div>

            <!--<section class="share">-->
    <!--<h3>Share</h3>-->
    <!--<a aria-label="Compartilhar no Twitter" href="https://twitter.com/intent/tweet?text=&quot;&quot;%20http://localhost:4000/BUG-TRACKING-1/%20via%20&#64;@zum_com&hashtags=membase,bugtracking,resource,io,nosql,"-->
    <!--onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">-->
        <!--<svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>-->
    <!--</a>-->
    <!--<a aria-label="Compartilhar no Facebook"href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/BUG-TRACKING-1/"-->
    <!--onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">-->
        <!--<svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>-->
    <!--</a>-->
    <!--<a aria-label="Share on Google Plus" href="https://plus.google.com/share?url=http://localhost:4000/BUG-TRACKING-1/"-->
    <!--onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">-->
        <!--<svg class="icon icon-google-plus"><use xlink:href="#icon-google-plus"></use></svg>-->
    <!--</a>-->
<!--</section>-->

            <section class="author" itemprop="author">
  <div class="details" itemscope itemtype="http://schema.org/Person">
    <img itemprop="image" class="img-rounded" src="/images/portal/author/kingbbode.png" alt="">
    <p class="def">포털개발팀 권용근 담당</p>
    <h3 class="name">
      <a itemprop="name" href="https://github.com/zuminternet">ZUM tech</a>
    </h3>
    <p class="desc">zum.com service <br/> Front-End & Back-End Developer.</p>
    <p>
      
      <a itemprop="github" href="https://github.com/zuminternet" title="Github">
        <svg><use xlink:href="#icon-github"></use></svg>
      </a>
      
      
      <a itemprop="facebook" href="https://www.facebook.com/zumcom" title="Facebook">
        <svg><use xlink:href="#icon-facebook"></use></svg>
      </a>
      
      
      <a itemprop="twitter" href="https://twitter.com/@zum_com" title="Twitter">
        <svg><use xlink:href="#icon-twitter"></use></svg>
      </a>
      
      
      
      
    </p>
  </div>
</section>

            <!--<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'disqus_username';
        var disqus_title = '';
        var disqus_url = '/BUG-TRACKING-1/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>
-->
            <footer>
    <p>
      
      <a itemprop="github" href="https://github.com/zuminternet" title="Github">
        <svg><use xlink:href="#icon-github"></use></svg>
      </a>
      
      
      <a itemprop="facebook" href="https://www.facebook.com/zumcom" title="Facebook">
        <svg><use xlink:href="#icon-facebook"></use></svg>
      </a>
      
      
      <a itemprop="twitter" href="https://twitter.com/@zum_com" title="Twitter">
        <svg><use xlink:href="#icon-twitter"></use></svg>
      </a>
      
      
      
      
    </p>
    <ul>

        <!---->
          <!--<li><a href="http://localhost:4000">Home</a></li>-->
        <!---->
          <!--<li><a href="http://localhost:4000">Contact</a></li>-->
        <!---->

        <li><a href="http://localhost:4000">Home</a></li>
        <li><a href="http://zuminternet.com" target="_blank">Contact</a></li>
        <li><a class="feed" href="http://localhost:4000/feed.xml" title="Atom/RSS feed">Feed</a></li>
    </ul>
</footer>
<script src="/assets/js/main.js"></script>
// <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-XXXXXXXX-X', 'auto');
  ga('send', 'pageview');

</script>
  


        </section>
    </body>
</html>
